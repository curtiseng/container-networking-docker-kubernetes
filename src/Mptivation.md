###  第一章 动机

------

在这一章节，我将向您介绍*宠物模式*下和*牲畜模式*下计算基础设施以及容器网络所涉及的内容。如果你对基础设施和网络比较熟悉，可以跳过这一章节。

#### 介绍 *宠物模式* 和 *牲畜模式*

在2012年二月，Randy Bias关于开放和可扩展云架构主题做了一个有效的演讲。在他的陈述中，他提出了*pets versus cattle*模式。

+ 用*宠物模式*来管理基础设施，你把机器当成个体。给每个(虚拟)机器一个名称，应用程序被静态地分配给机器。例如，`db-prod-2`是生产环境服务的数据库所在的机器。应用程序是手动部署的，当机器生病时，你必须让他恢复健康，并手动重新部署你的应用程序到另一台机器上。这种方法通常被认为是以前(非云原生)时代的主导范例。
+ 用*牲畜模式*来管理基础设施，你的机器是非特定的；它们都是相同的(模块化硬件升级)，它们有数字而不是名字，应用程序被自动部署到任何一台机器上。当其中一台机器生病时，你不会马上担心他;你可以在你想要的时候替换它，或者部分替换它，比如一个有问题的硬盘驱动器，而不是当东西坏掉的时候。

最初这种模式关注的是虚拟机，而我们将牛群方法应用于基础设施。

#### *牲畜模式*！

使用管理牲畜的方法来管理基础设施的好处是，他容许你水平扩展硬件的规模。

*牲畜模式*提供了混合云概念中的弹性。一个特定的例子是你可将应用的部分部署在私有机器上，在你需要扩展的时候，直接可以使用公有云。

最重要的是,从运维者的角度来看,*牲畜模式*允许你安心的睡觉,你不必担心在凌晨3点更换坏掉的硬盘驱动器或重新挂应用到不同的服务器上。

然而，*牲畜模式*也带来了一些挑战，一般可以归纳为以下两个方面：

**推广挑战：**

我敢说，大多数挑战都具有社会性:我如何说服我的经理?我如何从我的首席技术官那里得到股份?我的同事们会反对这种新的做事方式吗?这是否意味着我们需要更少的人来管理我们的基础设施?

**技术挑战：**

这类问题包括处理诸如机器的基本运维问题。例如，使用Ansible安装Kubernetes组件，如何在容器和外部世界之间建立通信连接，最重要的是，如何确保容器被自动部署和被发现。

现在你已经了解了*pets versus cattle*，接下来对容器网络的整体技术栈做一个认识。

#### 容器网络技术栈

我们介绍的堆栈包含以下内容：

***The low-level networking layer***

这包括网络设备、iptables、路由、IPVLAN和Linux名称空间。除非你在网络团队中， 你通常不需要知道这个层的细节，但是你至少应该知道它。这些技术已经存在并使用了10年以上。

***The container networking layer***

这一层提供了一些底层的抽象，比如单主机模式和多主机模式网桥、IP-per-container解决方案。在第二章和第三章中介绍了这一层。

***The container orchestration layer***

这里，我们将把容器调度器关于在何处放置容器的决定与底层提供的原语结合起来。在第4章中，我们将讨论总体的容器编排系统，在第5章中，我们将重点讨论服务发现方面，包括负载平衡。第6章讨论了容器网络标准CNI，最后在第7章我们讨论了Kubernetes网络。

> SDN(*Software-Defined Networking*)实际上是一个概括(营销)术语，它提供了与虚拟机(VMs)通过裸金属服务器引入的网络相同的优势。通过这种方法，网络管理团队变得更加敏捷，能够更快地对不断变化的业务需求做出反应。另一种看法是:SDN是使用软件的网络配置，无论是通过api，补充网络功能虚拟化，还是通过软件构建网络。
> 特别是如果您是开发人员或架构师，我建议您快速浏览一下Cisco关于这个主题的[优秀概述](http://bit.ly/1O5p7KB)，以及SDxCentral的文章“[什么是软件定义的网络(SDN)](https://bit.ly/2jvUkiO)?”

如果你是网络运维团队的一员，你应该可以很好进入下一章。如果你是一名架构师或开发人员，你的网络知识可能有点生疏，建议在继续之前先温习一下[Linux网络管理员指南](http://www.tldp.org/LDP/nag2/nag2.pdf)。

#### 我需要“All In”吗？

通常，当我参加研讨会或者用户组时，我遇到许多人对容器领域的机会十分兴奋。同时，人们本能的也担心需要多大程度的投入才能从中受益。下表提供了我搜集的部署规模的非正式概述，按照各个阶段所表达的级别进行分组:

| 阶段        | 典型的设施                                   | 例子                         |
| ----------- | -------------------------------------------- | ---------------------------- |
| Traditional | 裸机或者VM，没有容器                         | 现在大部分的生产部署         |
| Simple      | 手动管理应用依赖，手动运行容器               | 开发和测试环境               |
| Ad hoc      | 自定义、自定义调度器，用于启动和重新启动容器 | RelateIQ, Uber               |
| Full-blown  | 调度程序来管理容器;容错,自愈                 | Google, Zulily, Gutefrage.de |

请注意，阶段不一定与部署的规模相一致。例如，Gutefrage.de只有6台需要管理的物理服务器，但是使用Apache Mesos来管理它们，并且您可以在树莓Pi上轻松地运行Kubernetes集群。

在我们继续之前还有最后一点:到目前为止，您可能已经意识到我们在这里讨论的是分布式系统。鉴于我们通常希望将容器部署到计算机网络中，我建议您阅读一下[分布式计算的谬误](https://en.wikipedia.org/wiki/Fallacies_of_distributed_computing)，以防您还不熟悉这个主题。

现在让我们继续讨论容器网络的深层问题。